(this["webpackJsonpavito-test-app"]=this["webpackJsonpavito-test-app"]||[]).push([[0],{22:function(t,e,n){t.exports={autors:"Stories_autors__2lThZ",li:"Stories_li__2FJFg",buttonWrapper:"Stories_buttonWrapper__3UyA8"}},23:function(t,e,n){t.exports={rootComment:"Story_rootComment__16V45",wrapper:"Story_wrapper__8BoKb",title:"Story_title__X3Hxh"}},32:function(t,e,n){t.exports={loader:"Preloader_loader__1Ps0i"}},33:function(t,e,n){t.exports={subComment:"SubComment_subComment__10mPb"}},39:function(t,e,n){},40:function(t,e,n){},47:function(t,e,n){"use strict";n.r(e);var s=n(1),r=n(0),c=n.n(r),i=n(16),o=n.n(i),a=(n(39),n(40),n(9)),l=n.n(a),u=n(13),j=n(18),p=n(19),h=n(21),m=n(20),b=n(12),d=n(22),f=n.n(d),O=n(11),g=n(32),x=n.n(g),v=n.p+"static/media/loader.e88c5d6a.svg",y=function(){return Object(s.jsx)("div",{className:x.a.loader,children:Object(s.jsx)("img",{src:v,alt:""})})},k=function(t){return Object(s.jsx)("div",{children:t.isFetching?Object(s.jsx)(y,{}):Object(s.jsxs)("div",{className:f.a.autors,children:[Object(s.jsxs)("div",{className:f.a.buttonWrapper,children:[Object(s.jsx)("button",{onClick:function(){t.reload()},children:"Reload"}),Object(s.jsx)("button",{onClick:function(){t.onToggleNewsTypeClick(!t.state.newsType)},children:t.state.newsType?"Get top stories":"Get new stories"})]}),Object(s.jsx)("ul",{children:t.state.storiesData.map((function(t){return Object(s.jsx)(O.b,{to:"/".concat(t.id),children:Object(s.jsxs)("li",{className:f.a.li,children:[Object(s.jsx)("div",{children:t.title}),Object(s.jsxs)("div",{children:["Rate: ",t.score]}),Object(s.jsxs)("div",{children:["By: ",t.by]}),Object(s.jsx)("div",{children:(e=t.time,new Date(1e3*e).toLocaleString())})]})},t.id);var e}))})]})})},w=n(29),C=n(4),_="SET_STORY",S="SET_STORIES",T="SET_COMMENTS",D="TOGGLE_IS_FETCHING",N="TOGGLE_NEWS_TYPE",F={storyData:{},storiesData:[],commentsData:[],subCommentsData:[],isFetching:!1,newsType:!0},E=function(t){return{type:D,isFetching:t}},I=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case _:return Object(C.a)(Object(C.a)({},t),{},{storyData:Object(C.a)({},e.story)});case S:return Object(C.a)(Object(C.a)({},t),{},{commentsData:[],storiesData:Object(w.a)(e.stories)});case T:if("comment"===e.parentType){var n=t.subCommentsData.map((function(t){return t.id})),s=[];return e.comments.forEach((function(t){t.deleted||n.includes(t.id)||s.push(Object(C.a)({},t))})),s.sort((function(t,e){return t.time>e.time?1:t.time<e.time?-1:0})),Object(C.a)(Object(C.a)({},t),{},{subCommentsData:[].concat(Object(w.a)(t.subCommentsData),s)})}var r=[];return e.comments.forEach((function(t){t.deleted||r.push(Object(C.a)({},t))})),r.sort((function(t,e){return t.time<e.time?1:t.time>e.time?-1:0})),Object(C.a)(Object(C.a)({},t),{},{commentsData:[].concat(r)});case D:return Object(C.a)(Object(C.a)({},t),{},{isFetching:e.isFetching});case N:return Object(C.a)(Object(C.a)({},t),{},{newsType:!t.newsType});default:return t}},P=function(t){Object(h.a)(n,t);var e=Object(m.a)(n);function n(){var t;Object(j.a)(this,n);for(var s=arguments.length,r=new Array(s),c=0;c<s;c++)r[c]=arguments[c];return(t=e.call.apply(e,[this].concat(r))).getNewStories=Object(u.a)(l.a.mark((function e(){var n,s,r,c,i,o,a,u=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>0&&void 0!==u[0]&&u[0],s=u.length>1&&void 0!==u[1]?u[1]:t.props.state.newsType,n||t.props.toggleIsFetching(!0),r="https://hacker-news.firebaseio.com/v0/".concat(s?"new":"top","stories.json"),e.prev=5,e.next=8,fetch(r);case 8:if(!1!==(c=e.sent).ok){e.next=11;break}throw new Error("Response Error:"+c.text);case 11:return e.next=13,c.json();case 13:return i=e.sent,o=i.slice(0,100).map((function(t){return fetch("https://hacker-news.firebaseio.com/v0/item/".concat(t,".json")).then((function(t){return t.json()}))})),e.next=17,Promise.all(o);case 17:a=e.sent,t.props.setStories(a),t.props.toggleIsFetching(!1),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(5),console.error(e.t0);case 25:case"end":return e.stop()}}),e,null,[[5,22]])}))),t.onToggleNewsTypeClick=function(e){t.props.toggleNewsType(),t.getNewStories(!1,e)},t._tick=function(){t.getNewStories(!0)},t}return Object(p.a)(n,[{key:"componentDidMount",value:function(){this.getNewStories(),this.timer=setInterval(this._tick,6e4)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){return Object(s.jsx)(k,{onToggleNewsTypeClick:this.onToggleNewsTypeClick,reload:this.getNewStories,isFetching:this.props.isFetching,state:this.props.state})}}]),n}(c.a.Component),R=Object(b.b)((function(t){return{state:t.storiesPage,isFetching:t.storiesPage.isFetching}}),(function(t){return{setStories:function(e){t(function(t){return{type:S,stories:t}}(e))},toggleIsFetching:function(e){t(E(e))},toggleNewsType:function(){t({type:N})}}}))(P),B=n(3),L=n(23),G=n.n(L),M=n(33),W=n.n(M),H=function t(e){return Object(s.jsx)("div",{children:e.SD.map((function(n){return n.parent===e.id?Object(s.jsxs)("ul",{onClick:function(t){t.stopPropagation(),e.onCommentClick(n.id,n.type)},className:W.a.subComment,children:[Object(s.jsx)("li",{dangerouslySetInnerHTML:{__html:n.text}}),Object(s.jsxs)("li",{children:["By:",n.by]}),n.kids?Object(s.jsxs)("li",{children:["Replies: ",n.kids.length]}):null,n.kids?Object(s.jsx)(t,{onCommentClick:e.onCommentClick,SD:e.SD,id:n.id,state:n}):null]},n.id):null}))})},U=function(t){var e=function(t){return new Date(1e3*t).toLocaleString()};return Object(s.jsx)("div",{className:G.a.wrapper,children:Object(s.jsxs)("div",{children:[Object(s.jsxs)("ul",{children:[Object(s.jsx)("li",{className:G.a.title,children:t.state.storyData.title}),Object(s.jsx)("li",{children:Object(s.jsx)("a",{href:t.state.storyData.url,rel:"noreferrer",target:"_blank",children:t.state.storyData.url})}),Object(s.jsx)("li",{children:e(t.state.storyData.time)}),Object(s.jsxs)("li",{children:["By: ",t.state.storyData.by]}),t.state.storyData.kids?Object(s.jsxs)("li",{children:["Comments:  ",t.state.commentsData.length]}):null,Object(s.jsx)("li",{children:Object(s.jsx)("button",{onClick:function(){t.updateComments(t.state.storyData.id)},children:"Update comments"})}),Object(s.jsx)("li",{children:Object(s.jsx)(O.b,{to:"/",children:Object(s.jsx)("button",{children:"Back"})})})]}),t.isFetching?Object(s.jsx)(y,{}):Object(s.jsx)("ul",{children:t.state.commentsData.map((function(n){return Object(s.jsxs)("li",{onClick:function(){t.updateComments(n.id,n.type)},className:G.a.rootComment,children:[Object(s.jsx)("div",{dangerouslySetInnerHTML:{__html:n.text}}),Object(s.jsxs)("div",{children:["By: ",n.by]}),Object(s.jsx)("div",{children:e(n.time)}),n.kids?Object(s.jsxs)("div",{children:["Replies: ",n.kids.length]}):null,n.kids?Object(s.jsx)(H,{onCommentClick:t.updateComments,SD:t.state.subCommentsData,id:n.id,state:n}):null]},n.id)}))})]})})},A=function(t){Object(h.a)(n,t);var e=Object(m.a)(n);function n(){var t;Object(j.a)(this,n);for(var s=arguments.length,r=new Array(s),c=0;c<s;c++)r[c]=arguments[c];return(t=e.call.apply(e,[this].concat(r))).getNewComments=function(){var e=Object(u.a)(l.a.mark((function e(n,s){var r,c,i,o,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s||(t.props.toggleIsFetching(!0),s="story"),r="https://hacker-news.firebaseio.com/v0/item/".concat(n,".json"),e.prev=2,e.next=5,fetch(r);case 5:if(!1!==(c=e.sent).ok){e.next=8;break}throw new Error("Response Error:"+c.text);case 8:return e.next=10,c.json();case 10:if(void 0===(i=e.sent).kids){e.next=17;break}return o=i.kids.map((function(t){return fetch("https://hacker-news.firebaseio.com/v0/item/".concat(t,".json")).then((function(t){return t.json()}))})),e.next=15,Promise.all(o);case 15:a=e.sent,t.props.setComments(a,s);case 17:t.props.toggleIsFetching(!1),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(2),console.error(e.t0);case 23:case"end":return e.stop()}}),e,null,[[2,20]])})));return function(t,n){return e.apply(this,arguments)}}(),t.getStory=function(){var e=Object(u.a)(l.a.mark((function e(n){var s,r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="https://hacker-news.firebaseio.com/v0/item/".concat(n,".json?print=pretty"),e.prev=1,e.next=4,fetch(s);case 4:if(!1!==(r=e.sent).ok){e.next=7;break}throw new Error("Response Error:"+r.text);case 7:return e.next=9,r.json();case 9:c=e.sent,t.props.setStory(c),t.props.toggleIsFetching(!1),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),console.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}(),t._tick=function(e){t.getNewComments(e,!0)},t}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var t=this,e=this.props.location.pathname.slice(1);this.getNewComments(e),this.getStory(e),this.timer=setInterval((function(){t._tick(t.props.state.storyData.id)}),6e4)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"render",value:function(){return Object(s.jsx)(U,{isFetching:this.props.isFetching,state:this.props.state,updateComments:this.getNewComments})}}]),n}(c.a.Component),J=Object(b.b)((function(t){return{state:t.storiesPage,isFetching:t.storiesPage.isFetching}}),(function(t){return{setComments:function(e,n){t(function(t,e){return{type:T,comments:t,parentType:e}}(e,n))},setStory:function(e){t(function(t){return{type:_,story:t}}(e))},toggleIsFetching:function(e){t(E(e))}}}))(A);var Y=function(){return Object(s.jsxs)(O.a,{basename:"/avito-test-app",children:[Object(s.jsx)("div",{className:"header",children:Object(s.jsx)("p",{children:"Hacker News"})}),Object(s.jsx)("div",{className:"app-wrapper",children:Object(s.jsxs)("div",{className:"content",children:[Object(s.jsx)("div",{children:Object(s.jsx)(B.a,{exact:!0,path:"/",children:Object(s.jsx)(R,{})})}),Object(s.jsx)(B.a,{exact:!0,path:"/:id",component:J})]})})]})},K=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,48)).then((function(e){var n=e.getCLS,s=e.getFID,r=e.getFCP,c=e.getLCP,i=e.getTTFB;n(t),s(t),r(t),c(t),i(t)}))},V=n(15),X=Object(V.b)({storiesPage:I}),Z=Object(V.c)(X);o.a.render(Object(s.jsx)(b.a,{store:Z,children:Object(s.jsx)(c.a.StrictMode,{children:Object(s.jsx)(Y,{})})}),document.getElementById("root")),K()}},[[47,1,2]]]);
//# sourceMappingURL=main.d6cbd0e9.chunk.js.map